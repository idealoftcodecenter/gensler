<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>SVG Map Game – Sample</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<style>
		/* Layout */
		* {
			box-sizing: border-box;
		}

		body {
			margin: 0;
			font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
			background: #0b2144;
			color: #ffffff;
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 100vh;
		}

		.game {
			display: flex;
			gap: 24px;
			width: 94vw;
			max-width: 1200px;
		}

		.left-ui {
			width: 220px;
			display: flex;
			flex-direction: column;
			justify-content: space-between;
		}

		.map-wrapper {
			flex: 1;
			background: #101f3b;
			padding: 16px;
			border-radius: 16px;
			box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.08);
		}

		.map-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 12px;
			font-size: 14px;
			opacity: 0.9;
		}

		.map-pill {
			padding: 4px 12px;
			border-radius: 999px;
			background: #ffb300;
			color: #1b1b1b;
			font-weight: 600;
			font-size: 12px;
			text-transform: uppercase;
			letter-spacing: 0.06em;
		}

		.map-pill.inactive {
			background: rgba(255, 255, 255, 0.08);
			color: rgba(255, 255, 255, 0.7);
		}

		/* Arrow pad */
		.arrow-pad {
			display: inline-flex;
			flex-direction: column;
			gap: 8px;
			align-items: center;
			margin-top: 32px;
		}

		.arrow-row {
			display: flex;
			gap: 8px;
		}

		.arrow-key {
			width: 48px;
			height: 48px;
			border-radius: 8px;
			border: none;
			background: rgba(255, 255, 255, 0.06);
			color: #ffffff;
			font-size: 20px;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			outline: none;
			transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.08s ease, opacity 0.15s ease;
		}

		.arrow-key:active {
			transform: translateY(1px);
			box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.6);
		}

		.arrow-key.available {
			background: #ffb300;
			color: #141414;
			box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.4);
		}

		.arrow-key.disabled {
			opacity: 0.25;
			cursor: default;
		}

		/* Info */
		.info-block {
			margin-top: 16px;
			font-size: 13px;
			line-height: 1.5;
			max-width: 220px;
			opacity: 0.95;
		}

		.info-label {
			font-size: 12px;
			text-transform: uppercase;
			letter-spacing: 0.08em;
			opacity: 0.7;
			margin-bottom: 4px;
		}

		.counter {
			margin-top: 12px;
			font-size: 13px;
		}

		.counter span.value {
			font-weight: 600;
			color: #ffb300;
		}

		/* SVG */
		svg {
			width: 100%;
			height: auto;
			display: block;
			border-radius: 12px;
			background: #071733;
		}

		.map-bg {
			fill: #111f3f;
			stroke: #ffffff;
			stroke-opacity: 0.08;
		}

		.edge {
			fill: none;
			stroke: #ffcf66;
			stroke-width: 4;
			stroke-linecap: round;
			stroke-dasharray: 8 8;
			opacity: 0.7;
		}

		.edge.visited {
			stroke-dasharray: none;
			stroke: #ff4f9a;
			opacity: 1;
		}

		.node {
			fill: #ffe9b3;
			stroke: #111827;
			stroke-width: 2;
		}

		.node.place {
			fill: #34d399;
		}

		.node.place.visited-place {
			fill: #22c55e;
			stroke: #e5fffb;
			stroke-width: 3;
		}

		.place-label {
			font-size: 12px;
			fill: #ffffff;
			opacity: 0.8;
		}

		.player {
			fill: #00e0ff;
			stroke: #ffffff;
			stroke-width: 3;
		}

		.player-ring {
			fill: none;
			stroke: rgba(0, 224, 255, 0.7);
			stroke-width: 3;
		}

		@media (max-width: 768px) {
			.game {
				flex-direction: column;
			}

			.left-ui {
				flex-direction: row;
				width: 100%;
				justify-content: space-between;
				align-items: center;
			}

			.info-block {
				max-width: none;
			}
		}
	</style>
</head>
<body>

	<div class="game">

		<div class="left-ui">
			<div>
				<h2 style="margin:0 0 8px 0; font-size:22px;">Outdoor Amenities</h2>
				<div style="font-size:14px; opacity:0.8;">
					Use arrow keys to move.<br>
					You can only walk on dashed paths.
				</div>

				<div class="arrow-pad">
					<div class="arrow-row">
						<button class="arrow-key key-up" data-dir="up">↑</button>
					</div>
					<div class="arrow-row">
						<button class="arrow-key key-left" data-dir="left">←</button>
						<button class="arrow-key key-down" data-dir="down">↓</button>
						<button class="arrow-key key-right" data-dir="right">→</button>
					</div>
				</div>

				<div class="info-block">
					<div class="info-label">How it works</div>
					<div>
						You move from junction to junction. At each junction, only valid
						directions light up. Walked paths become solid. Green circles are
						points of interest.
					</div>

					<div class="counter">
						Visited places:
						<span class="value" id="visited-count">0</span>/<span id="places-total">0</span>
					</div>
				</div>
			</div>

			<div>
                <!-- just a tiny mock for multi-map indicator -->
				<div class="info-label">Map</div>
				<div style="display:flex; gap:8px; flex-wrap:wrap;">
					<span class="map-pill">Outdoor (active)</span>
					<span class="map-pill inactive">Reception</span>
					<span class="map-pill inactive">Offices</span>
				</div>
			</div>
		</div>

		<div class="map-wrapper">
			<div class="map-header">
				<span>Outdoor Amenities Plan (sample layout)</span>
				<span style="font-size:12px; opacity:0.7;">Current map: Outdoor</span>
			</div>

			<!-- Sample SVG Map (replace with your real SVG later) -->
			<svg id="map-outdoor" viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg">
				<rect class="map-bg" x="8" y="8" width="784" height="434" rx="18" />

				<!-- Dashed walking paths (edges) -->
				<line class="edge" data-edge="n1-n2" x1="400" y1="225" x2="400" y2="90" />
				<line class="edge" data-edge="n2-n6" x1="400" y1="90" x2="520" y2="90" />
				<line class="edge" data-edge="n1-n3" x1="400" y1="225" x2="550" y2="225" />
				<line class="edge" data-edge="n3-cafe" x1="550" y1="225" x2="650" y2="225" />
				<line class="edge" data-edge="n1-n4" x1="400" y1="225" x2="400" y2="360" />
				<line class="edge" data-edge="n4-park" x1="400" y1="360" x2="280" y2="360" />
				<line class="edge" data-edge="n1-n5" x1="400" y1="225" x2="260" y2="225" />
				<line class="edge" data-edge="n5-n7" x1="260" y1="225" x2="260" y2="120" />

				<!-- Junction nodes -->
				<circle class="node" cx="400" cy="225" r="6"
					data-node-id="n1"
					data-neighbors="up:n2,right:n3,down:n4,left:n5" />

				<circle class="node" cx="400" cy="90" r="6"
					data-node-id="n2"
					data-neighbors="down:n1,right:n6" />

				<circle class="node" cx="520" cy="90" r="6"
					data-node-id="n6"
					data-neighbors="left:n2" />

				<circle class="node" cx="550" cy="225" r="6"
					data-node-id="n3"
					data-neighbors="left:n1,right:cafe" />

				<circle class="node" cx="400" cy="360" r="6"
					data-node-id="n4"
					data-neighbors="up:n1,left:park" />

				<circle class="node" cx="260" cy="225" r="6"
					data-node-id="n5"
					data-neighbors="right:n1,up:n7" />

				<circle class="node" cx="260" cy="120" r="6"
					data-node-id="n7"
					data-neighbors="down:n5" />

				<!-- Places of interest -->
				<circle class="node place" cx="650" cy="225" r="8"
					data-node-id="cafe"
					data-neighbors="left:n3"
					data-place-name="Outdoor coffee kiosk" />

				<text class="place-label" x="650" y="205">Coffee kiosk</text>

				<circle class="node place" cx="280" cy="360" r="8"
					data-node-id="park"
					data-neighbors="right:n4"
					data-place-name="Outdoor seating deck" />

				<text class="place-label" x="220" y="345">Seating deck</text>

				<!-- Player character (simple circle + ring) -->
				<circle id="player" class="player" cx="400" cy="225" r="10" />
				<circle id="player-ring" class="player-ring" cx="400" cy="225" r="16" />
			</svg>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script>
		$(function () {
			const KEY_TO_DIR = {
				37: "left",
				38: "up",
				39: "right",
				40: "down"
			};

			const $player = $("#player");
			const $playerRing = $("#player-ring");
			const $arrowKeys = $(".arrow-key");
			const $visitedCount = $("#visited-count");
			const $placesTotal = $("#places-total");

			const graph = {};
			const gameState = {
				currentMap: "outdoor",
				currentNodeId: "n1",
				visitedNodes: {},
				visitedPlaces: {},
				traversedEdges: {}
			};

			initGraphFromSvg();
			initUi();
			bindEvents();

			function initGraphFromSvg() {
				$("[data-node-id]").each(function () {
					const $node = $(this);
					const id = String($node.data("node-id"));
					const neighborsStr = ($node.data("neighbors") || "").toString();
					const neighbors = {};

					if (neighborsStr.length > 0) {
						neighborsStr.split(",").forEach(function (pair) {
							const parts = pair.split(":");
							if (parts.length === 2) {
								const dir = parts[0].trim();
								const dest = parts[1].trim();
								if (dir && dest) {
									neighbors[dir] = dest;
								}
							}
						});
					}

					const isPlace = $node.hasClass("place");
					const cx = parseFloat($node.attr("cx"));
					const cy = parseFloat($node.attr("cy"));

					graph[id] = {
						id: id,
						$el: $node,
						x: cx,
						y: cy,
						neighbors: neighbors,
						isPlace: isPlace,
						placeName: $node.data("place-name") || null
					};
				});

				// total places for UI
				let totalPlaces = 0;
				Object.keys(graph).forEach(function (id) {
					if (graph[id].isPlace) {
						totalPlaces++;
					}
				});
				$placesTotal.text(totalPlaces);

				// initial position
				positionPlayerAt(gameState.currentNodeId, false);
				markVisitedNode(gameState.currentNodeId);
				updateAvailableDirections();
				updateVisitedUi();
			}

			function initUi() {
				updateAvailableDirections();
			}

			function bindEvents() {
				$(document).on("keydown", function (e) {
					const dir = KEY_TO_DIR[e.which];
					if (!dir) {
						return;
					}
					e.preventDefault();
					attemptMove(dir);
				});

				$arrowKeys.on("click", function () {
					const dir = $(this).data("dir");
					attemptMove(dir);
				});
			}

			function attemptMove(dir) {
				const currentNode = graph[gameState.currentNodeId];
				if (!currentNode) {
					return;
				}

				const nextNodeId = currentNode.neighbors[dir];
				if (!nextNodeId) {
					return;
				}

				moveToNode(nextNodeId, dir);
			}

			function moveToNode(nextNodeId, dir) {
				const currentNodeId = gameState.currentNodeId;
				const currentNode = graph[currentNodeId];
				const nextNode = graph[nextNodeId];

				if (!nextNode) {
					return;
				}

				// update state
				gameState.currentNodeId = nextNodeId;
				markVisitedNode(nextNodeId);
				markTraversedEdge(currentNodeId, nextNodeId);

				// move player
				positionPlayerAt(nextNodeId, true);

				// places
				if (nextNode.isPlace) {
					markVisitedPlace(nextNodeId);
				}

				updateAvailableDirections();
				updateVisitedUi();
			}

			function positionPlayerAt(nodeId, animate) {
				const node = graph[nodeId];
				if (!node) {
					return;
				}

				const targetX = node.x;
				const targetY = node.y;

				if (!animate) {
					$player.attr("cx", targetX);
					$player.attr("cy", targetY);
					$playerRing.attr("cx", targetX);
					$playerRing.attr("cy", targetY);
					return;
				}

				const duration = 200; // ms

				$({ x: parseFloat($player.attr("cx")), y: parseFloat($player.attr("cy")) })
					.animate(
						{ x: targetX, y: targetY },
						{
							duration: duration,
							step: function (now, fx) {
								if (fx.prop === "x") {
									$player.attr("cx", fx.now);
									$playerRing.attr("cx", fx.now);
								} else if (fx.prop === "y") {
									$player.attr("cy", fx.now);
									$playerRing.attr("cy", fx.now);
								}
							}
						}
					);
			}

			function markVisitedNode(nodeId) {
				if (!gameState.visitedNodes[nodeId]) {
					gameState.visitedNodes[nodeId] = true;
				}
			}

			function markTraversedEdge(fromId, toId) {
				const key = edgeKey(fromId, toId);
				if (!gameState.traversedEdges[key]) {
					gameState.traversedEdges[key] = true;
				}

				// mark SVG edge as visited (solid path)
				// we assume edges are stored as "a-b" or "b-a"
				const selector = '[data-edge="' + fromId + "-" + toId + '"], [data-edge="' + toId + "-" + fromId + '"]';
				$(selector).addClass("visited");
			}

			function markVisitedPlace(nodeId) {
				if (!gameState.visitedPlaces[nodeId]) {
					gameState.visitedPlaces[nodeId] = true;
					const node = graph[nodeId];
					if (node && node.isPlace) {
						node.$el.addClass("visited-place");
					}
				}
			}

			function updateAvailableDirections() {
				const currentNode = graph[gameState.currentNodeId];
				const dirs = ["up", "right", "down", "left"];

				dirs.forEach(function (dir) {
					const $btn = $('.arrow-key[data-dir="' + dir + '"]');
					if (currentNode.neighbors[dir]) {
						$btn.removeClass("disabled").addClass("available");
					} else {
						$btn.removeClass("available").addClass("disabled");
					}
				});
			}

			function updateVisitedUi() {
				let count = 0;
				Object.keys(gameState.visitedPlaces).forEach(function (id) {
					if (gameState.visitedPlaces[id]) {
						count++;
					}
				});
				$visitedCount.text(count);
			}

			function edgeKey(a, b) {
				return a < b ? a + "-" + b : b + "-" + a;
			}
		});
	</script>
</body>
</html>
